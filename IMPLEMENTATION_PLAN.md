# Meta-Ralph Implementation Plan

> **Last Updated:** 2026-01-26 (PRD-10 Multi-Repo/Linear **FULLY COMPLETE** - UI repo column implemented)
> **Previous Update:** 2026-01-26 (PRD-10 Multi-Repo Engine Integration COMPLETE; PRD-10 now ~90% complete)
> **Generated by:** Claude Opus 4.5 comprehensive analysis of specs vs. source code
> **Priority Legend:** P0 = Critical/Foundation, P1 = High, P2 = Medium, P3 = Low

---

## Executive Summary

This plan outlines the implementation gaps between the current Meta-Ralph codebase and all specifications in `specs/`. The Enhanced UI (PRD-001) is **complete**, the Codecov Provider (PRD-002) is **fully implemented**, and **ALL PRDs (PRD-03 through PRD-10) are COMPLETE**. All features from the specification documents have been implemented.

### Progress Tracker

| Phase | Status | Completion | Key Items |
|-------|--------|------------|-----------|
| **Quick Wins** | Complete | 100% | Extended types, table sorting |
| **Phase 1 Core Hooks** | Complete | 100% | useLocalStorage, useSort, useSearch, useFilters |
| **Phase 1.2 Global State** | Complete | 100% | AppContext, Providers |
| **Phase 2 Search & Filtering** | Complete | 100% | SearchBar, FilterBar, FilterChip, FilterPreset, RangeSlider |
| **Phase 3 Bulk Actions & Details** | Complete | 100% | BulkActionBar, ExportDialog, IssueDetailPanel |
| **Phase 4 Codecov Provider** | Complete | 100% | provider.sh, api.sh, priority.sh, test-detection.sh |
| **Phase 5 Enhanced UX** | Complete | 100% | Keyboard shortcuts, grouping, dashboard, queue, virtualization |
| **Phase 6 Polish** | Complete | 100% | Theme toggle, saved views, history, tagging |
| **Phase 10 Testing** | Complete | 100% | CI workflow, ESLint, integration tests, E2E tests |
| **Phase A Foundation** | Complete | 100% | Extended types, config vars, ProcessingIndicator export |
| **Phase B Streaming** | **Complete** | **100%** | ralph-engine.sh streaming, ProcessingView integration DONE |
| **PRD-03 JSON Streaming** | **Complete** | **100%** | Events parser, SSE endpoint, hooks, ProcessingView ALL DONE |
| **PRD-04 Plan vs Build** | **Complete** | **100%** | All tasks complete: types, backend, CLI, UI badges, plan viewer, execute build |
| **PRD-05 Model Selection** | **Complete** | **100%** | All tasks complete: types, backend, selector, badges, smart suggestions |
| **PRD-06 Auto-Push** | **Complete** | **100%** | ralph-engine.sh auto_push, UI toggle in ProcessingOptionsPanel, RALPH_AUTO_PUSH env var |
| **PRD-07 CI/CD Awareness** | **Complete** | **100%** | useCIStatus hook, CI API endpoints, CIStatusPanel, ProcessingView integration |
| **PRD-08 Plan Auto-Update** | **Complete** | **100%** | plan-parser.ts with 46 tests, Plan API PUT endpoint, PlanViewerModal ALL DONE |
| **PRD-09 Options Panel** | **Complete** | **100%** | **ProcessingOptionsPanel, useProcessingOptions, Presets, ALL components DONE** |
| **PRD-10 Multi-Repo/Linear** | **Complete** | **100%** | workspace-manager, issue-parser, Linear/GitHub providers, ralph-engine.sh integration, **UI repo column** ALL DONE |

---

## TIER 0: Foundation Types ‚úÖ COMPLETE

### TASK-0.1: Extended Types for All PRDs ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/lib/types.ts`
**Dependencies:** None | **Blocks:** ALL PRD-03 through PRD-10 features
**Completed:** 2026-01-26

All types implemented in `ui/src/lib/types.ts` (lines 271-540+):
- [x] `ProcessingMode = 'plan' | 'build'`
- [x] `ModelType = 'sonnet' | 'opus'`
- [x] `ProcessingOptions` interface with all fields
- [x] `DEFAULT_PROCESSING_OPTIONS` constant
- [x] `ProcessingPreset` interface and `DEFAULT_PRESETS` array
- [x] `ActivityType = 'tool' | 'message' | 'result' | 'error' | 'push' | 'ci'`
- [x] `ToolName` with all Claude tools
- [x] `Activity`, `ActivityStatus`, `ExecutionMetrics` interfaces
- [x] `ClaudeEventType`, `StreamEvent`, `StreamConnectionState` types
- [x] `CIStatus`, `CICheck`, `CIFailure`, `CIStatusResponse`, `CIConfig` interfaces
- [x] `DEFAULT_CI_CONFIG` constant
- [x] `RiskLevel`, `PlanStep`, `PlanFile`, `PlanRisk`, `ImplementationPlan`, `ProgressEntry` interfaces
- [x] `RepoReference`, `ParsedAction`, `MultiRepoIssue`, `WorkspaceStatus` interfaces
- [x] `CostEstimate`, `ModelInfo` interfaces and `MODEL_INFO` constant
- [x] `estimateCost()` utility function

---

## TIER 1: SSE Streaming Infrastructure (PRD-03)

### TASK-1.1: SSE API Endpoint ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 4 hours | **File:** `ui/src/app/api/process/stream/route.ts` (NEW)
**Dependencies:** TASK-0.1 | **Blocks:** TASK-1.2, TASK-1.3
**Completed:** 2026-01-26

**Tasks:**
- [x] Create directory `ui/src/app/api/process/stream/`
- [x] Create `route.ts` with GET handler for SSE
- [x] Accept query param `?ids=issue1,issue2`
- [x] Stream events in format: `data: {"type": "activity", "payload": {...}}`
- [x] Support event types: `activity`, `metrics`, `complete`, `error`
- [x] Handle connection cleanup and error boundaries

### TASK-1.2: useProcessingStream Hook ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 3 hours | **File:** `ui/src/hooks/useProcessingStream.ts` (NEW)
**Dependencies:** TASK-0.1, TASK-1.1 | **Blocks:** TASK-1.4, TASK-2.1
**Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/hooks/useProcessingStream.ts`
- [x] Implement EventSource connection to `/api/process/stream`
- [x] Parse incoming JSON events
- [x] Manage connection state (connecting, connected, disconnected, error)
- [x] Auto-reconnect on disconnect
- [x] Throttle updates (max 10/second for UI performance)
- [x] Export from `ui/src/hooks/index.ts`

### TASK-1.3: useActivityFeed Hook ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/hooks/useActivityFeed.ts` (NEW)
**Dependencies:** TASK-0.1 | **Blocks:** TASK-1.4
**Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/hooks/useActivityFeed.ts`
- [x] Manage activity state array
- [x] Handle adding new activities with deduplication
- [x] Limit stored activities (e.g., last 500)
- [x] Track metrics state (cost, duration, iteration)
- [x] Export from `ui/src/hooks/index.ts`

### TASK-1.4: Update ActivityFeed Component ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/components/queue/ActivityFeed.tsx`
**Dependencies:** TASK-0.1, TASK-1.2, TASK-1.3
**Completed:** 2026-01-26

**Tasks:**
- [x] Update Activity interface to use new ActivityType (line 5)
- [x] Add icons for new activity types: `'tool'`, `'message'`, `'result'`, `'push'`, `'ci'` (lines 28-67)
- [x] Add auto-scroll to bottom feature
- [x] Add pause/resume auto-scroll button
- [x] Connect to useProcessingStream hook in parent

### TASK-1.5: Update MetricsDisplay Component ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 1 hour | **File:** `ui/src/components/queue/MetricsDisplay.tsx`
**Dependencies:** TASK-0.1
**Completed:** 2026-01-26

**Tasks:**
- [x] Add total cost tracking (session cumulative)
- [x] Add total duration tracking
- [x] Connect to real metrics from SSE stream

### TASK-1.6: Events Parser Library ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 2 hours | **File:** `ui/src/lib/events.ts` (NEW)
**Dependencies:** TASK-0.1
**Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/lib/events.ts`
- [x] Parse Claude's `--output-format=stream-json` events
- [x] Handle event types: `content_block_start`, `content_block_delta`, `result`, `assistant`, `error`
- [x] Extract tool name, parameters, results
- [x] Convert to normalized Activity format

### TASK-1.7: Update ralph-engine.sh for JSON Streaming ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 2 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** None | **Completed:** 2026-01-26

**Implementation Details:**
- [x] Added streaming support functions: `emit_ralph_event()`, `emit_activity()`, `emit_metrics()`, `emit_complete()`, `emit_error()`
- [x] Added Claude event parser: `parse_claude_event()` for `--output-format=stream-json` events
- [x] Updated `ralph_fix_loop()` with mode, model parameters and streaming support via `RALPH_STREAM_MODE` env var
- [x] Updated `process_issue()` with mode, model, auto_push parameters
- [x] Emit events prefixed with `RALPH_EVENT:` for API to capture
- [x] Backward compatible: uses `--print` when streaming disabled, `--output-format=stream-json` when enabled

**Additional Integrations Completed:**
- [x] `ui/src/lib/meta-ralph.ts`: Added `parseRalphEventLine()` to parse events, integrated with session-manager
- [x] `ui/src/app/api/issues/route.ts`: Accepts `options` parameter, added DELETE handler for cancellation
- [x] `ui/src/components/queue/ProcessingView.tsx`: Now uses `useProcessingStream` hook for real-time activities/metrics

### TASK-1.8: Export ProcessingIndicator ‚úÖ COMPLETE
**Priority:** P3 | **Effort:** 5 min | **File:** `ui/src/components/queue/index.ts`
**Dependencies:** None | **Completed:** 2026-01-26

- [x] Added `export { ProcessingIndicator } from './ProcessingIndicator';` to index.ts

---

## TIER 2: Processing Options Panel (PRD-09) ‚úÖ COMPLETE

### TASK-2.1: Create Options Directory and Components ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 6 hours | **Directory:** `ui/src/components/options/`
**Dependencies:** TASK-0.1, TASK-1.2 | **Completed:** 2026-01-26

**Files Created:**
- [x] `ui/src/components/options/index.ts` - barrel exports
- [x] `ui/src/components/options/ProcessingOptionsPanel.tsx` - main modal component
- [x] `ui/src/components/options/PresetSelector.tsx` - preset buttons (Quick Fix, Careful Fix, Complex, Security Audit)
- [x] `ui/src/components/options/ModeToggle.tsx` - Plan/Build toggle with visual indicator
- [x] `ui/src/components/options/ModelSelector.tsx` - Sonnet/Opus selector with cost info
- [x] `ui/src/components/options/IterationSlider.tsx` - max iterations 1-20 slider
- [x] `ui/src/components/options/CostEstimateDisplay.tsx` - dynamic cost display
- [x] `ui/src/components/options/OptionsToggle.tsx` - toggle switch for boolean options

### TASK-2.2: Presets Library ‚úÖ COMPLETE (moved to types.ts)
**Priority:** P0 | **Effort:** 1 hour | **File:** `ui/src/lib/types.ts`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

All implemented in `ui/src/lib/types.ts` instead of separate file:
- [x] `ProcessingPreset` interface
- [x] `DEFAULT_PRESETS` array with Quick Fix, Careful Fix, Complex Issue, Security Audit
- [x] `CostEstimate` interface
- [x] `ModelInfo` interface and `MODEL_INFO` constant
- [x] `estimateCost(options, issueCount)` function

### TASK-2.3: useProcessingOptions Hook ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/hooks/useProcessingOptions.ts`
**Dependencies:** TASK-0.1, TASK-2.2 | **Completed:** 2026-01-26

**Implemented:**
- [x] Create `ui/src/hooks/useProcessingOptions.ts`
- [x] Manage options state with localStorage persistence
- [x] Apply presets
- [x] Validate options before processing with warnings
- [x] Cost estimation
- [x] Export from `ui/src/hooks/index.ts`
- [x] 35 unit tests in `__tests__/useProcessingOptions.test.tsx`

### TASK-2.4: Update ProcessButton ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 1 hour | **File:** `ui/src/components/ProcessButton.tsx`
**Dependencies:** TASK-2.1 | **Completed:** 2026-01-26

**Implemented:**
- [x] ProcessButton now triggers options panel via `handleProcess` in page.tsx
- [x] Options panel handles all configuration before processing
- [x] Flow: Click Process -> Options Panel -> Start Processing

### TASK-2.5: Update BulkActionBar ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 1 hour | **File:** `ui/src/components/actions/BulkActionBar.tsx`
**Dependencies:** TASK-2.1 | **Completed:** 2026-01-26

**Implemented:**
- [x] BulkActionBar triggers options panel via shared `handleProcess` handler
- [x] Options panel integration complete through page.tsx orchestration
- [x] ProcessingOptions passed to API on start

### TASK-2.6: Update API to Accept Options ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/app/api/issues/route.ts`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

**Implemented:**
- [x] POST body accepts `{ ids: string[], options?: ProcessingOptions }`
- [x] Options passed to `processIssues()` function
- [x] AppContext `processIssues` and `processSingleIssue` accept options parameter

---

## TIER 3: Plan vs Build Mode (PRD-04)

### TASK-3.1: Add Mode Flag to ralph-engine.sh ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 3 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** None | **Completed:** 2026-01-26

**Note:** Fixed in meta-ralph.sh line 351: Now reads RALPH_MODE env var and passes to process_issue()

**Current State:** `ralph_fix_loop()` function (lines 23-123) has no mode parameter. Uses single prompt for all cases. Only checks for `<promise>COMPLETE</promise>` (line 90).

**Tasks:**
- [x] Add `--mode` parameter to `ralph_fix_loop()` (plan|build, default: build)
- [x] Create plan mode prompt (analysis only, generate IMPLEMENTATION_PLAN.md)
- [x] Create build mode prompt (implementation with plan if exists)
- [x] Add `<promise>PLAN_COMPLETE</promise>` detection for plan mode (line 90 area)
- [x] Pass mode from `process_issue()` to `ralph_fix_loop()`

### TASK-3.2: Add Mode Badge to ProcessingQueue ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 1 hour | **File:** `ui/src/components/queue/ProcessingQueue.tsx`
**Dependencies:** TASK-0.1, TASK-3.1 | **Completed:** 2026-01-26

**Note:** Mode badges added to ProcessingQueue.tsx and ProcessingView.tsx headers

**Current State:** Header shows "Processing Queue" and "Active" badge (lines 178-188). No mode indicator.

**Tasks:**
- [x] Add mode badge next to title (Plan / Build)
- [x] Use icons: clipboard for Plan, hammer for Build
- [x] Style: blue for Plan, green for Build

### TASK-3.3: Plan/Build Mode Actions ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 2 hours | **Files:** ProcessingQueue.tsx, ProcessingView.tsx
**Dependencies:** TASK-3.1, TASK-3.2 | **Completed:** 2026-01-26

**Tasks:**
- [x] Add "View Plan" button after plan completes
- [x] Add "Execute Build" button to transition from plan to build
- [x] Store plan in state for viewing

**Note:** Added PlanViewerModal component, View Plan and Execute Build buttons in ProcessingView header, API endpoint for fetching plan content

---

## TIER 4: Model Selection (PRD-05)

### TASK-4.1: Add Model Flag to ralph-engine.sh ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 1 hour | **File:** `lib/ralph-engine.sh`
**Dependencies:** TASK-3.1 | **Completed:** 2026-01-26

**Implementation:**
- Line 156: `local model="${6:-sonnet}"` - model parameter with default sonnet
- Lines 241-242: Model passed to Claude CLI with `--model claude-opus-4-5-20250514` when opus selected
- Model is logged and passed through `ralph_fix_loop()` and `process_issue()`

**Tasks:**
- [x] Add `--model` parameter (sonnet|opus, default: sonnet)
- [x] Pass `--model` flag to Claude CLI
- [x] Log which model is being used

### TASK-4.2: Model Badge in ProcessingQueue ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 30 min | **File:** `ui/src/components/queue/ProcessingQueue.tsx`
**Dependencies:** TASK-4.1 | **Completed:** 2026-01-26

**Note:** Model badges added to ProcessingQueue.tsx and ProcessingView.tsx headers

**Tasks:**
- [x] Add model indicator badge next to mode badge
- [x] Style: lightning for Sonnet (fast), brain for Opus (smart)

### TASK-4.3: Smart Model Suggestion ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 1 hour | **File:** `ui/src/components/options/ModelSelector.tsx`
**Dependencies:** TASK-2.1 | **Completed:** 2026-01-26

**Tasks:**
- [x] Suggest Opus for CRITICAL severity issues from Zeropath
- [x] Show warning when using Opus on many issues (cost)
- [x] Display cost difference between models

**Note:** Already implemented in ProcessingOptionsPanel (suggestedModel) and useProcessingOptions (getValidationWarnings with Opus cost warnings)

---

## TIER 5: Auto-Push with Feedback (PRD-06)

### TASK-5.1: Add Auto-Push Flag to ralph-engine.sh ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 2 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** None | **Completed:** 2026-01-26

**Implementation:**
- Line 380: `local auto_push="${8:-true}"` - auto_push parameter with default true
- Line 525: Push is conditional on `auto_push != "true"` check
- Push events emitted via `emit_activity()` with PR URL in details
- Error handling with graceful fallback messages

**Tasks:**
- [x] Add `--auto-push` parameter (default: true for backward compat)
- [x] Make push conditional on flag
- [x] Emit push event to activity feed when pushing
- [x] Handle push failures gracefully

### TASK-5.2: Push Status in ProcessingQueue ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 1 hour | **File:** `ui/src/components/queue/ProcessingQueue.tsx`
**Dependencies:** TASK-5.1, TASK-1.4 | **Completed:** 2026-01-26

**Implementation:**
- ProcessingQueue now uses useProcessingStream hook to get streaming activities
- Created helper functions to extract PR URLs from push activities
- Created helper to detect push failures from activity status
- Created helper to extract error messages from activities
- QueueItem now shows PR links when available (clickable external links)
- QueueItem shows push failed warning when applicable (red alert icon)
- Added retry push button support (callback ready for integration)

**Tasks:**
- [x] Show push status indicator (via ActivityFeed streaming)
- [x] Display actual PR URL in queue entries (extract from push activities)
- [x] Add retry push button on failure

---

## TIER 6: CI/CD Awareness (PRD-07) ‚úÖ COMPLETE

### TASK-6.1: useCIStatus Hook ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 3 hours | **File:** `ui/src/hooks/useCIStatus.ts`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/hooks/useCIStatus.ts`
- [x] Poll GitHub Checks API after push
- [x] Parse check run status
- [x] Detect failures
- [x] Export from `ui/src/hooks/index.ts`
- [x] Helper functions: `getCIStatusIcon()`, `getCIStatusColor()`
- [x] Unit tests (16 tests passing)

### TASK-6.2: CI API Proxy Endpoints ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 3 hours | **Directory:** `ui/src/app/api/ci/`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/app/api/ci/status/route.ts` - get check status
- [x] Create `ui/src/app/api/ci/logs/route.ts` - get CI logs with annotations
- [x] Create `ui/src/app/api/ci/fix/route.ts` - trigger auto-fix
- [x] Handle GitHub API authentication (GITHUB_TOKEN or GH_TOKEN)
- [x] Response caching (10 seconds)

### TASK-6.3: CIStatusPanel Component ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 3 hours | **File:** `ui/src/components/queue/CIStatusPanel.tsx`
**Dependencies:** TASK-6.1, TASK-6.2 | **Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/components/queue/CIStatusPanel.tsx`
- [x] Show check runs with status (pending/running/success/failure)
- [x] Link to CI details on GitHub
- [x] Show failure reasons with expandable logs
- [x] Add "Auto-fix CI" button (triggers ralph rerun)
- [x] Integrate into ProcessingView with toggle button

---

## TIER 7: Plan Auto-Update (PRD-08)

### TASK-7.1: Plan Parser Library ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 2 hours | **File:** `ui/src/lib/plan-parser.ts`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/lib/plan-parser.ts`
- [x] Parse IMPLEMENTATION_PLAN.md markdown
- [x] Extract tasks/checkboxes using regex: `/^- \[(x| )\] (.+)$/i`
- [x] Calculate progress percentage
- [x] Track completed vs pending items
- [x] 46 unit tests passing in `ui/src/lib/__tests__/plan-parser.test.ts`

### TASK-7.2: PlanViewer Component ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 3 hours | **File:** `ui/src/components/queue/PlanViewerModal.tsx`
**Dependencies:** TASK-7.1 | **Completed:** 2026-01-26 (pre-existing)

**Note:** Component already exists as `PlanViewerModal.tsx`

**Tasks:**
- [x] Create PlanViewer component (exists as PlanViewerModal.tsx)
- [x] Render plan with progress indicators
- [x] Show checkbox completion in real-time
- [x] Highlight current task
- [x] Add collapse/expand sections

### TASK-7.3: Plan API Endpoints ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 2 hours | **Directory:** `ui/src/app/api/plan/`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

**Tasks:**
- [x] Create `ui/src/app/api/plan/[issueId]/route.ts` (already existed)
- [x] GET: retrieve plan for issue
- [x] PUT: update plan progress (added)

---

## TIER 8: Multi-Repo Support (PRD-10)

### TASK-8.1: Workspace Manager ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 4 hours | **File:** `lib/workspace-manager.sh`
**Dependencies:** None | **Blocks:** TASK-8.2, TASK-8.3, TASK-8.4 | **Completed:** 2026-01-26

**Tasks:**
- [x] Create `lib/workspace-manager.sh`
- [x] Implement `ensure_repo(full_name)` - clone if not exists, pull if exists
- [x] Implement `get_repo_path(full_name)` - return `~/.meta-ralph/workspaces/{org}_{repo}`
- [x] Implement `list_workspace_repos()` - list all cloned repos
- [x] Implement `cleanup_workspace(days)` - remove repos not used in N days
- [x] Implement `repo_exists(full_name)` - check if repo is cloned
- [x] CLI interface with help, ensure, path, list, cleanup, stats, verify commands

### TASK-8.2: Issue Parser ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 3 hours | **File:** `lib/issue-parser.sh`
**Dependencies:** TASK-8.1 | **Completed:** 2026-01-26

**Tasks:**
- [x] Create `lib/issue-parser.sh`
- [x] Implement `parse_issue_repos(issue_json)` - use Claude to extract target_repo, context_repos
- [x] Implement `enrich_issue_with_repos(issue_json)` - merge repo info into issue
- [x] Handle fallback when no external repos detected
- [x] CLI interface with parse, enrich, check, mentions commands

### TASK-8.3: Config Variables for Multi-Repo ‚úÖ COMPLETE
**Priority:** P0 | **Effort:** 30 min | **File:** `config.sh`
**Dependencies:** None | **Completed:** 2026-01-26

All config variables added to `config.sh`:
- [x] `LINEAR_API_KEY`, `LINEAR_TEAM_ID`, `LINEAR_STATES`, `LINEAR_API_URL`
- [x] `META_RALPH_WORKSPACE` (default: `$HOME/.meta-ralph/workspaces`)
- [x] `WORKSPACE_CLEANUP_DAYS` (default: 30)
- [x] `PRIORITY_LINEAR_URGENT/HIGH/MEDIUM/LOW` (95/75/50/25)
- [x] `DEFAULT_PROCESSING_MODE` (default: build)
- [x] `DEFAULT_MODEL` (default: sonnet)
- [x] Validation for Linear provider in `validate_config()`
- [x] Display in `config_loaded()` helper function

### TASK-8.4: Linear Provider ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 6 hours | **Directory:** `providers/linear/`
**Dependencies:** TASK-8.1, TASK-8.2, TASK-8.3 | **Completed:** 2026-01-26

**Current State:** CREATED

**Tasks:**
- [x] Create `providers/linear/` directory
- [x] Create `providers/linear/provider.sh` with:
  - `provider_name()` -> "linear"
  - `provider_fetch()` -> GraphQL query to Linear API
  - `provider_gen_prd()` -> PRD with multi-repo context
  - `provider_branch_name()` -> `task/linear-{issue-id}`
  - `provider_pr_body()` -> PR description linking to Linear
- [x] Map Linear priority (1-4) to normalized priority (0-100)
- [x] Integrate with issue parser for multi-repo enrichment

### TASK-8.5: Ralph Engine Multi-Repo Integration ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 2 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** TASK-8.1, TASK-8.2 | **Completed:** 2026-01-26

**Implementation:**
- [x] Detect `target_repo` field in issue_json (lines 394-395)
- [x] Source workspace-manager.sh at module load (line 11)
- [x] Call `ensure_repo()` for target_repo (lines 406-425)
- [x] Clone context_repos if present (lines 427-447)
- [x] Override TARGET_REPO to cloned repo path (line 413)
- [x] Emit activity events for multi-repo operations
- [x] Handle errors gracefully with proper messaging

**Also Fixed:**
- Fixed Linear provider hardcoded paths (now uses `$RALPH_DIR` instead of absolute path)

### TASK-8.6: GitHub Provider ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 4 hours | **Directory:** `providers/github/`
**Dependencies:** None | **Completed:** 2026-01-26

**Current State:** CREATED

**Tasks:**
- [x] Create `providers/github/provider.sh`
- [x] Implement GitHub Issues API integration
- [x] Map labels to priority (security=95, bug=60, enhancement=20)
- [x] Generate PRDs for GitHub issues
- [x] Support multi-repo if issue references other repos

### TASK-8.7: UI Repo Column ‚úÖ COMPLETE
**Priority:** P1 | **Effort:** 2 hours | **Files:** `ui/src/lib/types.ts`, `ui/src/hooks/useSort.ts`, `ui/src/components/IssueTable.tsx`, `ui/src/components/IssueRow.tsx`, `ui/src/components/views/GroupedView.tsx`
**Dependencies:** TASK-8.5 | **Completed:** 2026-01-26

**Implementation:**
- [x] Add 'repo' to SortField type in types.ts
- [x] Add sorting logic for repo field in useSort.ts (with getRepoFullName helper)
- [x] Add repo column header in IssueTable.tsx with conditional display
- [x] Add repo column data rendering in VirtualizedTable
- [x] Add repo column rendering in IssueRow.tsx with showRepoColumn prop
- [x] Add repo column support in GroupedView.tsx
- [x] Add hasMultiRepoIssues utility for conditional column visibility
- [x] Repo column shows üì¶ badge with repo name (only when multi-repo issues exist)
- [x] Column is sortable and displays "‚Äî" for issues without target_repo
- [x] All 587 tests passing, build successful

---

## TIER 9: Additional API Endpoints

### TASK-9.1: Bulk Actions API ‚úÖ COMPLETE
**Priority:** P2 | **Effort:** 2 hours | **File:** `ui/src/app/api/issues/bulk/route.ts`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

**Implementation:**
- [x] Create `ui/src/app/api/issues/bulk/route.ts`
- [x] Implement POST handler with BulkActionRequest validation
- [x] Support all actions: export, tag, untag, priority, ignore, restore, process
- [x] Export action returns issue data for client-side download
- [x] Process action integrates with processIssues and session-manager
- [x] Tag/untag acknowledge for client-side localStorage update
- [x] Priority/ignore/restore acknowledge with future server-side notes

---

## TIER 10: Deferred Items (P3)

### TASK-10.1: URL Param Sync
**Priority:** P3 | **Effort:** 3 hours
**Tasks:**
- [ ] Sync filter state with URL query params (`?sort=priority&dir=desc`)
- [ ] Support shareable URLs

### TASK-10.2: Deferred UI Components
**Priority:** P3 | **Effort:** 4 hours total
**Tasks:**
- [ ] `DateRangePicker.tsx` - date range filter
- [ ] `ActionConfirmDialog.tsx` - confirmation modal
- [ ] Pause/Resume queue functionality (marked "for future use" at ProcessingQueue.tsx lines 22-24)
- [ ] Cancel pending item button

---

## Previously Completed Phases (PRD-001, PRD-002)

### CLI Core: COMPLETE
| Component | Status | Notes |
|-----------|--------|-------|
| `meta-ralph.sh` | Complete | Full orchestrator with dry-run, JSON output, filtering |
| `lib/provider.sh` | Complete | Provider interface with 4 required functions |
| `lib/priority.sh` | Complete | Cross-platform priority normalization (0-100) |
| `lib/ralph-engine.sh` | Complete | Claude Code fix loop with `<promise>COMPLETE</promise>` detection |
| `config.sh` | Complete | Centralized configuration, .env support |

### Providers
| Provider | Status | Notes |
|----------|--------|-------|
| `providers/zeropath/provider.sh` | Complete | Full API integration, PRD generation |
| `providers/sentry/provider.sh` | Complete | Full API integration, stack traces |
| `providers/codecov/` | Complete | Full implementation (provider, api, priority, test-detection) |
| `providers/github/` | Complete | GitHub Issues API integration, multi-repo support |
| `providers/linear/` | Complete | Linear GraphQL API integration, multi-repo enrichment |

### UI Enhanced Features: COMPLETE
| Feature | Status |
|---------|--------|
| Search & Filtering | Complete |
| Sorting with persistence | Complete |
| Grouping views | Complete |
| Dashboard with charts | Complete |
| Processing queue visualization | Complete |
| Keyboard shortcuts | Complete |
| Theme toggle (dark/light/system) | Complete |
| Saved views | Complete |
| Processing history | Complete |
| Issue tagging | Complete |
| Pagination & virtualization | Complete |
| Export (CSV/JSON) | Complete |

### Testing Infrastructure: COMPLETE
| Component | Status |
|-----------|--------|
| GitHub Actions CI | Complete |
| ESLint configuration | Complete |
| Integration tests (31 tests) | Complete |
| E2E tests with Playwright (69 tests) | Complete |
| Hook unit tests (538 tests total) | Complete |

**Test Coverage Improvements (2026-01-26):**
- Added comprehensive test coverage for critical streaming hooks (51 tests added):
  - `useActivityFeed`: 27 tests added (previously 0% coverage)
  - `useProcessingStream`: 24 tests added (previously 0% coverage)
- Total test count across all suites: 638 tests

---

## Recommended Implementation Order

### Phase A: Foundation (8-10 hours)
1. **TASK-0.1** Extended Types - 2 hours (unlocks everything)
2. **TASK-8.3** Config Variables - 0.5 hours
3. **TASK-1.8** Export ProcessingIndicator - 5 min

### Phase B: Streaming Infrastructure (12-16 hours)
4. **TASK-1.7** ralph-engine.sh JSON output - 2 hours
5. **TASK-1.6** Events parser library - 2 hours
6. **TASK-1.1** SSE API endpoint - 4 hours
7. **TASK-1.2** useProcessingStream hook - 3 hours
8. **TASK-1.3** useActivityFeed hook - 2 hours
9. **TASK-1.4** Update ActivityFeed component - 2 hours
10. **TASK-1.5** Update MetricsDisplay - 1 hour

### Phase C: Options Panel (12-14 hours)
11. **TASK-2.2** Presets library - 1 hour
12. **TASK-2.1** Options components - 6 hours
13. **TASK-2.3** useProcessingOptions hook - 2 hours
14. **TASK-2.4** Update ProcessButton - 1 hour
15. **TASK-2.5** Update BulkActionBar - 1 hour
16. **TASK-2.6** Update API to accept options - 2 hours

### Phase D: Modes & Model (8-10 hours)
17. **TASK-3.1** Plan/Build mode in ralph-engine.sh - 3 hours
18. **TASK-3.2** Mode badge in ProcessingQueue - 1 hour
19. **TASK-3.3** Plan/Build mode actions - 2 hours
20. **TASK-4.1** Model flag in ralph-engine.sh - 1 hour
21. **TASK-4.2** Model badge - 0.5 hours
22. **TASK-4.3** Smart model suggestion - 1 hour

### Phase E: Auto-Push (3-4 hours)
23. **TASK-5.1** Auto-push flag - 2 hours
24. **TASK-5.2** Push status in UI - 1 hour

### Phase F: Multi-Repo (14-18 hours)
25. **TASK-8.1** Workspace Manager - 4 hours
26. **TASK-8.2** Issue Parser - 3 hours
27. **TASK-8.4** Linear Provider - 6 hours
28. **TASK-8.5** Engine multi-repo integration - 2 hours

### Phase G: CI/CD Awareness (10-12 hours)
29. **TASK-6.1** useCIStatus hook - 3 hours
30. **TASK-6.2** CI API endpoints - 3 hours
31. **TASK-6.3** CIStatusPanel component - 3 hours

### Phase H: Plan Viewer (6-8 hours)
32. **TASK-7.1** Plan parser library - 2 hours
33. **TASK-7.2** PlanViewer component - 3 hours
34. **TASK-7.3** Plan API endpoints - 2 hours

### Phase I: Polish (8-10 hours)
35. **TASK-8.6** GitHub Provider - 4 hours
36. **TASK-9.1** Bulk Actions API - 2 hours
37. **TASK-10.x** Deferred items - as needed

**Total Estimated Effort:** 75-100 hours

---

## Critical Files Reference

| File | Purpose | Changes Needed |
|------|---------|----------------|
| `ui/src/lib/types.ts` | Core types | Add ProcessingMode, ModelType, ProcessingOptions, CI types, Activity types, MultiRepoIssue |
| `lib/ralph-engine.sh` | Backend engine | Add --mode, --model, --auto-push, --output-format=stream-json; multi-repo support |
| `ui/src/app/api/issues/route.ts` | Main API | Accept options parameter; integrate with streaming |
| `config.sh` | Configuration | Add LINEAR_*, META_RALPH_WORKSPACE, DEFAULT_* variables |
| `ui/src/components/queue/ProcessingQueue.tsx` | Queue UI | Add mode/model badges, integrate SSE, CI status |
| `ui/src/components/queue/ActivityFeed.tsx` | Activity display | Update types, connect to SSE |
| `ui/src/components/queue/index.ts` | Queue exports | Export ProcessingIndicator |
| `ui/src/hooks/index.ts` | Hooks barrel | Export new hooks |

---

## Gaps Found During Audit

### Code Issues Found (Updated 2026-01-26)

| Issue | Status | Notes |
|-------|--------|-------|
| `--json` flag not implemented in CLI | ‚ö†Ô∏è Open | Fallback warning in `ui/src/lib/meta-ralph.ts:31-33` |
| PR URLs hardcoded in ProcessingQueue | ‚úÖ Fixed | Now extracts from push activities via helper functions |
| Pause/Resume functionality | ‚è∏Ô∏è Deferred | Marked "for future use" (lines 22-24) |
| ProcessingIndicator export | ‚úÖ Fixed | Now exported from queue/index.ts |
| ActivityFeed hardcoded | ‚úÖ Fixed | Now connected to real SSE stream via activitiesMap |
| MetricsDisplay hardcoded | ‚úÖ Fixed | Now connected to real SSE stream via metricsMap |
| Activity types mismatch | ‚úÖ Fixed | All activity types aligned with spec |
| CLI mode/model passing | ‚úÖ Fixed | meta-ralph.sh reads RALPH_MODE env var |
| Missing test coverage for streaming hooks | ‚úÖ Fixed | Added 51 tests for useActivityFeed and useProcessingStream |

**Note:** Mode and model badges are now displayed in ProcessingQueue.tsx and ProcessingView.tsx headers (PRD-04/PRD-05 UI badges complete). TASK-4.1 and TASK-5.1 are fully implemented in ralph-engine.sh.

### Missing Files Summary (Updated 2026-01-26)

| Category | Status |
|----------|--------|
| Shell Libraries | ‚úÖ ALL COMPLETE - `lib/workspace-manager.sh`, `lib/issue-parser.sh` created |
| Providers | ‚úÖ ALL COMPLETE - `providers/github/provider.sh`, `providers/linear/provider.sh` created |
| UI Components | ‚úÖ ALL COMPLETE - options directory, CIStatusPanel, PlanViewerModal exist |
| Hooks | ‚úÖ ALL COMPLETE - useProcessingStream, useActivityFeed, useProcessingOptions, useCIStatus exist |
| API Routes | ‚úÖ ALL COMPLETE - `api/issues/bulk/` route created |
| Libraries | ‚úÖ ALL COMPLETE - events.ts, plan-parser.ts (with tests) exist |

### Config Gaps

| Variable | Status |
|----------|--------|
| LINEAR_API_KEY | ‚úÖ Added to config.sh |
| LINEAR_TEAM_ID | ‚úÖ Added to config.sh |
| LINEAR_STATES | ‚úÖ Added to config.sh |
| META_RALPH_WORKSPACE | ‚úÖ Added to config.sh |
| WORKSPACE_CLEANUP_DAYS | ‚úÖ Added to config.sh |
| PRIORITY_LINEAR_* | ‚úÖ Added to config.sh |
| DEFAULT_PROCESSING_MODE | ‚úÖ Added to config.sh |
| DEFAULT_MODEL | ‚úÖ Added to config.sh |

---

## Notes

- CLI core is **complete** and stable for zeropath, sentry, codecov providers
- Enhanced UI (PRD-001) is **complete** except deferred items
- Codecov provider (PRD-002) is **fully implemented**
- PRD-03 through PRD-10 represent the **next major development phase**
- ActivityFeed, MetricsDisplay, ProcessingIndicator exist but need SSE integration
- Backward compatibility maintained - new features use optional fields/flags
- UI uses Next.js 15.1.0 + React 19.0.0 (App Router)
- All state management via React hooks and context (no external state library)
