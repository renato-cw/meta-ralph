# Meta-Ralph Implementation Plan

> **Last Updated:** 2026-01-26 (Phase A Foundation complete: types, config, exports)
> **Generated by:** Claude Opus 4.5 comprehensive analysis of specs vs. source code
> **Priority Legend:** P0 = Critical/Foundation, P1 = High, P2 = Medium, P3 = Low

---

## Executive Summary

This plan outlines the implementation gaps between the current Meta-Ralph codebase and all specifications in `specs/`. The Enhanced UI (PRD-001) is **mostly complete**, and the Codecov Provider (PRD-002) is **fully implemented**. However, the newer PRDs (PRD-03 through PRD-10) describing **JSON streaming, Plan/Build modes, model selection, CI/CD awareness, processing options panel, and Multi-Repo/Linear integration** are **largely not implemented**.

### Progress Tracker

| Phase | Status | Completion | Key Items |
|-------|--------|------------|-----------|
| **Quick Wins** | Complete | 100% | Extended types, table sorting |
| **Phase 1 Core Hooks** | Complete | 100% | useLocalStorage, useSort, useSearch, useFilters |
| **Phase 1.2 Global State** | Complete | 100% | AppContext, Providers |
| **Phase 2 Search & Filtering** | Complete | 100% | SearchBar, FilterBar, FilterChip, FilterPreset, RangeSlider |
| **Phase 3 Bulk Actions & Details** | Complete | 100% | BulkActionBar, ExportDialog, IssueDetailPanel |
| **Phase 4 Codecov Provider** | Complete | 100% | provider.sh, api.sh, priority.sh, test-detection.sh |
| **Phase 5 Enhanced UX** | Complete | 100% | Keyboard shortcuts, grouping, dashboard, queue, virtualization |
| **Phase 6 Polish** | Complete | 100% | Theme toggle, saved views, history, tagging |
| **Phase 10 Testing** | Complete | 100% | CI workflow, ESLint, integration tests, E2E tests |
| **Phase A Foundation** | Complete | 100% | Extended types, config vars, ProcessingIndicator export |
| **PRD-03 JSON Streaming** | Partial | 25% | Types added, ActivityFeed exists, SSE endpoint MISSING |
| **PRD-04 Plan vs Build** | Types Ready | 10% | ProcessingMode type DONE, mode toggle MISSING |
| **PRD-05 Model Selection** | Types Ready | 10% | ModelType DONE, selector UI MISSING |
| **PRD-06 Auto-Push** | Not Started | 0% | Push is unconditional, no toggle |
| **PRD-07 CI/CD Awareness** | Types Ready | 10% | CI types DONE, status panel MISSING |
| **PRD-08 Plan Auto-Update** | Types Ready | 10% | Plan types DONE, PlanViewer MISSING |
| **PRD-09 Options Panel** | Types Ready | 15% | Presets/types DONE, options/ directory MISSING |
| **PRD-10 Multi-Repo/Linear** | Foundation Ready | 15% | Config vars DONE, workspace-manager MISSING |

---

## TIER 0: Foundation Types ✅ COMPLETE

### TASK-0.1: Extended Types for All PRDs ✅ COMPLETE
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/lib/types.ts`
**Dependencies:** None | **Blocks:** ALL PRD-03 through PRD-10 features
**Completed:** 2026-01-26

All types implemented in `ui/src/lib/types.ts` (lines 271-540+):
- [x] `ProcessingMode = 'plan' | 'build'`
- [x] `ModelType = 'sonnet' | 'opus'`
- [x] `ProcessingOptions` interface with all fields
- [x] `DEFAULT_PROCESSING_OPTIONS` constant
- [x] `ProcessingPreset` interface and `DEFAULT_PRESETS` array
- [x] `ActivityType = 'tool' | 'message' | 'result' | 'error' | 'push' | 'ci'`
- [x] `ToolName` with all Claude tools
- [x] `Activity`, `ActivityStatus`, `ExecutionMetrics` interfaces
- [x] `ClaudeEventType`, `StreamEvent`, `StreamConnectionState` types
- [x] `CIStatus`, `CICheck`, `CIFailure`, `CIStatusResponse`, `CIConfig` interfaces
- [x] `DEFAULT_CI_CONFIG` constant
- [x] `RiskLevel`, `PlanStep`, `PlanFile`, `PlanRisk`, `ImplementationPlan`, `ProgressEntry` interfaces
- [x] `RepoReference`, `ParsedAction`, `MultiRepoIssue`, `WorkspaceStatus` interfaces
- [x] `CostEstimate`, `ModelInfo` interfaces and `MODEL_INFO` constant
- [x] `estimateCost()` utility function

---

## TIER 1: SSE Streaming Infrastructure (PRD-03)

### TASK-1.1: SSE API Endpoint
**Priority:** P0 | **Effort:** 4 hours | **File:** `ui/src/app/api/process/stream/route.ts` (NEW)
**Dependencies:** TASK-0.1 | **Blocks:** TASK-1.2, TASK-1.3

**Current State:** Directory does not exist. Only `ui/src/app/api/issues/route.ts` exists.

**Tasks:**
- [ ] Create directory `ui/src/app/api/process/stream/`
- [ ] Create `route.ts` with GET handler for SSE
- [ ] Accept query param `?ids=issue1,issue2`
- [ ] Stream events in format: `data: {"type": "activity", "payload": {...}}`
- [ ] Support event types: `activity`, `metrics`, `complete`, `error`
- [ ] Handle connection cleanup and error boundaries

### TASK-1.2: useProcessingStream Hook
**Priority:** P0 | **Effort:** 3 hours | **File:** `ui/src/hooks/useProcessingStream.ts` (NEW)
**Dependencies:** TASK-0.1, TASK-1.1 | **Blocks:** TASK-1.4, TASK-2.1

**Current State:** File does not exist. Hook index at `ui/src/hooks/index.ts` has 10 hooks.

**Tasks:**
- [ ] Create `ui/src/hooks/useProcessingStream.ts`
- [ ] Implement EventSource connection to `/api/process/stream`
- [ ] Parse incoming JSON events
- [ ] Manage connection state (connecting, connected, disconnected, error)
- [ ] Auto-reconnect on disconnect
- [ ] Throttle updates (max 10/second for UI performance)
- [ ] Export from `ui/src/hooks/index.ts`

### TASK-1.3: useActivityFeed Hook
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/hooks/useActivityFeed.ts` (NEW)
**Dependencies:** TASK-0.1 | **Blocks:** TASK-1.4

**Tasks:**
- [ ] Create `ui/src/hooks/useActivityFeed.ts`
- [ ] Manage activity state array
- [ ] Handle adding new activities with deduplication
- [ ] Limit stored activities (e.g., last 500)
- [ ] Track metrics state (cost, duration, iteration)
- [ ] Export from `ui/src/hooks/index.ts`

### TASK-1.4: Update ActivityFeed Component
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/components/queue/ActivityFeed.tsx`
**Dependencies:** TASK-0.1, TASK-1.2, TASK-1.3

**Current State:** File exists (lines 1-118). Uses old activity types: `'read' | 'edit' | 'bash' | 'success' | 'error' | 'info'`. Component is hardcoded to `activities={[]}` in ProcessingView.tsx (line 217).

**Tasks:**
- [ ] Update Activity interface to use new ActivityType (line 5)
- [ ] Add icons for new activity types: `'tool'`, `'message'`, `'result'`, `'push'`, `'ci'` (lines 28-67)
- [ ] Add auto-scroll to bottom feature
- [ ] Add pause/resume auto-scroll button
- [ ] Connect to useProcessingStream hook in parent

### TASK-1.5: Update MetricsDisplay Component
**Priority:** P1 | **Effort:** 1 hour | **File:** `ui/src/components/queue/MetricsDisplay.tsx`
**Dependencies:** TASK-0.1

**Current State:** File exists (lines 1-83). Has local `ExecutionMetrics` interface but lacks `totalCostUsd` and `totalDurationMs`. Hardcoded to `metrics={null}` in ProcessingView.tsx (line 225).

**Tasks:**
- [ ] Add total cost tracking (session cumulative)
- [ ] Add total duration tracking
- [ ] Connect to real metrics from SSE stream

### TASK-1.6: Events Parser Library
**Priority:** P1 | **Effort:** 2 hours | **File:** `ui/src/lib/events.ts` (NEW)
**Dependencies:** TASK-0.1

**Tasks:**
- [ ] Create `ui/src/lib/events.ts`
- [ ] Parse Claude's `--output-format=stream-json` events
- [ ] Handle event types: `content_block_start`, `content_block_delta`, `result`, `assistant`, `error`
- [ ] Extract tool name, parameters, results
- [ ] Convert to normalized Activity format

### TASK-1.7: Update ralph-engine.sh for JSON Streaming
**Priority:** P1 | **Effort:** 2 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** None

**Current State:** Lines 58-83 use `claude --print`. Need `--output-format=stream-json`.

**Tasks:**
- [ ] Change `--print` to `--output-format=stream-json` (line 58)
- [ ] Parse JSON output instead of text
- [ ] Emit events to stdout for API to capture
- [ ] Maintain backward compatibility with non-streaming mode

### TASK-1.8: Export ProcessingIndicator ✅ COMPLETE
**Priority:** P3 | **Effort:** 5 min | **File:** `ui/src/components/queue/index.ts`
**Dependencies:** None | **Completed:** 2026-01-26

- [x] Added `export { ProcessingIndicator } from './ProcessingIndicator';` to index.ts

---

## TIER 2: Processing Options Panel (PRD-09)

### TASK-2.1: Create Options Directory and Components
**Priority:** P0 | **Effort:** 6 hours | **Directory:** `ui/src/components/options/` (NEW)
**Dependencies:** TASK-0.1, TASK-1.2 | **Blocks:** TASK-2.2, TASK-2.3, TASK-2.4, TASK-2.5

**Current State:** Directory does NOT exist.

**Files to Create:**
- [ ] `ui/src/components/options/index.ts` - barrel exports
- [ ] `ui/src/components/options/ProcessingOptionsPanel.tsx` - main modal component
- [ ] `ui/src/components/options/PresetSelector.tsx` - preset buttons (Quick Fix, Careful Fix, Complex, Security Audit)
- [ ] `ui/src/components/options/ModeToggle.tsx` - Plan/Build toggle with visual indicator
- [ ] `ui/src/components/options/ModelSelector.tsx` - Sonnet/Opus selector with cost info
- [ ] `ui/src/components/options/IterationSlider.tsx` - max iterations 1-20 slider
- [ ] `ui/src/components/options/CostEstimate.tsx` - dynamic cost display

### TASK-2.2: Presets Library ✅ COMPLETE (moved to types.ts)
**Priority:** P0 | **Effort:** 1 hour | **File:** `ui/src/lib/types.ts`
**Dependencies:** TASK-0.1 | **Completed:** 2026-01-26

All implemented in `ui/src/lib/types.ts` instead of separate file:
- [x] `ProcessingPreset` interface
- [x] `DEFAULT_PRESETS` array with Quick Fix, Careful Fix, Complex Issue, Security Audit
- [x] `CostEstimate` interface
- [x] `ModelInfo` interface and `MODEL_INFO` constant
- [x] `estimateCost(options, issueCount)` function

### TASK-2.3: useProcessingOptions Hook
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/hooks/useProcessingOptions.ts` (NEW)
**Dependencies:** TASK-0.1, TASK-2.2

**Tasks:**
- [ ] Create `ui/src/hooks/useProcessingOptions.ts`
- [ ] Manage options state with localStorage persistence
- [ ] Apply presets
- [ ] Validate options before processing
- [ ] Export from `ui/src/hooks/index.ts`

### TASK-2.4: Update ProcessButton
**Priority:** P0 | **Effort:** 1 hour | **File:** `ui/src/components/ProcessButton.tsx`
**Dependencies:** TASK-2.1

**Current State:** Lines 1-39. Calls `onProcess()` directly without options.

**Tasks:**
- [ ] Add onClick to open ProcessingOptionsPanel instead of direct process
- [ ] Pass selected options to parent
- [ ] Show compact options summary when configured

### TASK-2.5: Update BulkActionBar
**Priority:** P0 | **Effort:** 1 hour | **File:** `ui/src/components/actions/BulkActionBar.tsx`
**Dependencies:** TASK-2.1

**Current State:** Lines 1-143. Process button (line 86-129) calls `onProcess()` directly.

**Tasks:**
- [ ] Add ProcessingOptionsPanel integration
- [ ] Update onProcess to receive ProcessingOptions
- [ ] Show options badge/summary near process button

### TASK-2.6: Update API to Accept Options
**Priority:** P0 | **Effort:** 2 hours | **File:** `ui/src/app/api/issues/route.ts`
**Dependencies:** TASK-0.1

**Current State:** Lines 30-89. POST accepts `{ ids: string[] }` only.

**Tasks:**
- [ ] Update POST body type to include `options?: ProcessingOptions`
- [ ] Pass options to `processIssues()` function
- [ ] Validate options server-side

---

## TIER 3: Plan vs Build Mode (PRD-04)

### TASK-3.1: Add Mode Flag to ralph-engine.sh
**Priority:** P0 | **Effort:** 3 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** None

**Current State:** `ralph_fix_loop()` function (lines 23-123) has no mode parameter. Uses single prompt for all cases. Only checks for `<promise>COMPLETE</promise>` (line 90).

**Tasks:**
- [ ] Add `--mode` parameter to `ralph_fix_loop()` (plan|build, default: build)
- [ ] Create plan mode prompt (analysis only, generate IMPLEMENTATION_PLAN.md)
- [ ] Create build mode prompt (implementation with plan if exists)
- [ ] Add `<promise>PLAN_COMPLETE</promise>` detection for plan mode (line 90 area)
- [ ] Pass mode from `process_issue()` to `ralph_fix_loop()`

### TASK-3.2: Add Mode Badge to ProcessingQueue
**Priority:** P1 | **Effort:** 1 hour | **File:** `ui/src/components/queue/ProcessingQueue.tsx`
**Dependencies:** TASK-0.1, TASK-3.1

**Current State:** Header shows "Processing Queue" and "Active" badge (lines 178-188). No mode indicator.

**Tasks:**
- [ ] Add mode badge next to title (Plan / Build)
- [ ] Use icons: clipboard for Plan, hammer for Build
- [ ] Style: blue for Plan, green for Build

### TASK-3.3: Plan/Build Mode Actions
**Priority:** P1 | **Effort:** 2 hours | **Files:** ProcessingQueue.tsx, ProcessingView.tsx
**Dependencies:** TASK-3.1, TASK-3.2

**Tasks:**
- [ ] Add "View Plan" button after plan completes
- [ ] Add "Execute Build" button to transition from plan to build
- [ ] Store plan in state for viewing

---

## TIER 4: Model Selection (PRD-05)

### TASK-4.1: Add Model Flag to ralph-engine.sh
**Priority:** P1 | **Effort:** 1 hour | **File:** `lib/ralph-engine.sh`
**Dependencies:** TASK-3.1

**Current State:** No model parameter. Claude CLI called without model specification (line 58).

**Tasks:**
- [ ] Add `--model` parameter (sonnet|opus, default: sonnet)
- [ ] Pass `--model` flag to Claude CLI
- [ ] Log which model is being used

### TASK-4.2: Model Badge in ProcessingQueue
**Priority:** P2 | **Effort:** 30 min | **File:** `ui/src/components/queue/ProcessingQueue.tsx`
**Dependencies:** TASK-4.1

**Tasks:**
- [ ] Add model indicator badge next to mode badge
- [ ] Style: lightning for Sonnet (fast), brain for Opus (smart)

### TASK-4.3: Smart Model Suggestion
**Priority:** P2 | **Effort:** 1 hour | **File:** `ui/src/components/options/ModelSelector.tsx`
**Dependencies:** TASK-2.1

**Tasks:**
- [ ] Suggest Opus for CRITICAL severity issues from Zeropath
- [ ] Show warning when using Opus on many issues (cost)
- [ ] Display cost difference between models

---

## TIER 5: Auto-Push with Feedback (PRD-06)

### TASK-5.1: Add Auto-Push Flag to ralph-engine.sh
**Priority:** P1 | **Effort:** 2 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** None

**Current State:** Push is unconditional (lines 198-223). Always pushes and creates PR.

**Tasks:**
- [ ] Add `--auto-push` parameter (default: true for backward compat)
- [ ] Make push conditional on flag
- [ ] Emit push event to activity feed when pushing
- [ ] Handle push failures gracefully

### TASK-5.2: Push Status in ProcessingQueue
**Priority:** P1 | **Effort:** 1 hour | **File:** `ui/src/components/queue/ProcessingQueue.tsx`
**Dependencies:** TASK-5.1, TASK-1.4

**Current State:** PR URLs hardcoded as `undefined` (line 106).

**Tasks:**
- [ ] Show push status indicator (Pushed / Push failed)
- [ ] Display actual PR URL when available
- [ ] Add retry push button on failure

---

## TIER 6: CI/CD Awareness (PRD-07)

### TASK-6.1: useCIStatus Hook
**Priority:** P2 | **Effort:** 3 hours | **File:** `ui/src/hooks/useCIStatus.ts` (NEW)
**Dependencies:** TASK-0.1

**Tasks:**
- [ ] Create `ui/src/hooks/useCIStatus.ts`
- [ ] Poll GitHub Checks API after push
- [ ] Parse check run status
- [ ] Detect failures
- [ ] Export from `ui/src/hooks/index.ts`

### TASK-6.2: CI API Proxy Endpoints
**Priority:** P2 | **Effort:** 3 hours | **Directory:** `ui/src/app/api/ci/` (NEW)
**Dependencies:** TASK-0.1

**Tasks:**
- [ ] Create `ui/src/app/api/ci/status/route.ts` - get check status
- [ ] Create `ui/src/app/api/ci/logs/route.ts` - get CI logs
- [ ] Handle GitHub API authentication
- [ ] Rate limiting and caching

### TASK-6.3: CIStatusPanel Component
**Priority:** P2 | **Effort:** 3 hours | **File:** `ui/src/components/queue/CIStatusPanel.tsx` (NEW)
**Dependencies:** TASK-6.1, TASK-6.2

**Tasks:**
- [ ] Create `ui/src/components/queue/CIStatusPanel.tsx`
- [ ] Show check runs with status (pending/success/failure)
- [ ] Link to CI details
- [ ] Show failure reasons
- [ ] Add "Auto-fix CI" button (triggers ralph rerun)

---

## TIER 7: Plan Auto-Update (PRD-08)

### TASK-7.1: Plan Parser Library
**Priority:** P2 | **Effort:** 2 hours | **File:** `ui/src/lib/plan-parser.ts` (NEW)
**Dependencies:** TASK-0.1

**Tasks:**
- [ ] Create `ui/src/lib/plan-parser.ts`
- [ ] Parse IMPLEMENTATION_PLAN.md markdown
- [ ] Extract tasks/checkboxes using regex: `/^- \[(x| )\] (.+)$/i`
- [ ] Calculate progress percentage
- [ ] Track completed vs pending items

### TASK-7.2: PlanViewer Component
**Priority:** P2 | **Effort:** 3 hours | **File:** `ui/src/components/queue/PlanViewer.tsx` (NEW)
**Dependencies:** TASK-7.1

**Tasks:**
- [ ] Create `ui/src/components/queue/PlanViewer.tsx`
- [ ] Render plan with progress indicators
- [ ] Show checkbox completion in real-time
- [ ] Highlight current task
- [ ] Add collapse/expand sections

### TASK-7.3: Plan API Endpoints
**Priority:** P2 | **Effort:** 2 hours | **Directory:** `ui/src/app/api/plan/` (NEW)
**Dependencies:** TASK-0.1

**Tasks:**
- [ ] Create `ui/src/app/api/plan/[issueId]/route.ts`
- [ ] GET: retrieve plan for issue
- [ ] PUT: update plan progress

---

## TIER 8: Multi-Repo Support (PRD-10)

### TASK-8.1: Workspace Manager
**Priority:** P0 | **Effort:** 4 hours | **File:** `lib/workspace-manager.sh` (NEW)
**Dependencies:** None | **Blocks:** TASK-8.2, TASK-8.3, TASK-8.4

**Tasks:**
- [ ] Create `lib/workspace-manager.sh`
- [ ] Implement `ensure_repo(full_name)` - clone if not exists, pull if exists
- [ ] Implement `get_repo_path(full_name)` - return `~/.meta-ralph/workspaces/{org}_{repo}`
- [ ] Implement `list_workspace_repos()` - list all cloned repos
- [ ] Implement `cleanup_workspace(days)` - remove repos not used in N days
- [ ] Implement `repo_exists(full_name)` - check if repo is cloned

### TASK-8.2: Issue Parser
**Priority:** P0 | **Effort:** 3 hours | **File:** `lib/issue-parser.sh` (NEW)
**Dependencies:** TASK-8.1

**Tasks:**
- [ ] Create `lib/issue-parser.sh`
- [ ] Implement `parse_issue_repos(issue_json)` - use Claude to extract target_repo, context_repos
- [ ] Implement `enrich_issue_with_repos(issue_json)` - merge repo info into issue
- [ ] Handle fallback when no external repos detected

### TASK-8.3: Config Variables for Multi-Repo ✅ COMPLETE
**Priority:** P0 | **Effort:** 30 min | **File:** `config.sh`
**Dependencies:** None | **Completed:** 2026-01-26

All config variables added to `config.sh`:
- [x] `LINEAR_API_KEY`, `LINEAR_TEAM_ID`, `LINEAR_STATES`, `LINEAR_API_URL`
- [x] `META_RALPH_WORKSPACE` (default: `$HOME/.meta-ralph/workspaces`)
- [x] `WORKSPACE_CLEANUP_DAYS` (default: 30)
- [x] `PRIORITY_LINEAR_URGENT/HIGH/MEDIUM/LOW` (95/75/50/25)
- [x] `DEFAULT_PROCESSING_MODE` (default: build)
- [x] `DEFAULT_MODEL` (default: sonnet)
- [x] Validation for Linear provider in `validate_config()`
- [x] Display in `config_loaded()` helper function

### TASK-8.4: Linear Provider
**Priority:** P1 | **Effort:** 6 hours | **Directory:** `providers/linear/` (NEW)
**Dependencies:** TASK-8.1, TASK-8.2, TASK-8.3

**Current State:** Directory does NOT exist.

**Tasks:**
- [ ] Create `providers/linear/` directory
- [ ] Create `providers/linear/provider.sh` with:
  - `provider_name()` -> "linear"
  - `provider_fetch()` -> GraphQL query to Linear API
  - `provider_gen_prd()` -> PRD with multi-repo context
  - `provider_branch_name()` -> `task/linear-{issue-id}`
  - `provider_pr_body()` -> PR description linking to Linear
- [ ] Map Linear priority (1-4) to normalized priority (0-100)
- [ ] Integrate with issue parser for multi-repo enrichment

### TASK-8.5: Ralph Engine Multi-Repo Integration
**Priority:** P1 | **Effort:** 2 hours | **File:** `lib/ralph-engine.sh`
**Dependencies:** TASK-8.1, TASK-8.2

**Current State:** `process_issue()` (lines 127-233) has basic TARGET_REPO support but no multi-repo logic.

**Add at line 137 (after TARGET_REPO check):**
- [ ] Detect `target_repo` field in issue_json
- [ ] Source workspace-manager.sh when field present
- [ ] Call `ensure_repo()` for target_repo
- [ ] Clone context_repos if present
- [ ] Override TARGET_REPO to cloned repo path

### TASK-8.6: GitHub Provider
**Priority:** P2 | **Effort:** 4 hours | **Directory:** `providers/github/`
**Dependencies:** None

**Current State:** Directory EXISTS but is EMPTY (no files).

**Tasks:**
- [ ] Create `providers/github/provider.sh`
- [ ] Implement GitHub Issues API integration
- [ ] Map labels to priority (security=95, bug=40, enhancement=10)
- [ ] Generate PRDs for GitHub issues
- [ ] Support multi-repo if issue references other repos

---

## TIER 9: Additional API Endpoints

### TASK-9.1: Bulk Actions API
**Priority:** P2 | **Effort:** 2 hours | **File:** `ui/src/app/api/issues/bulk/route.ts` (NEW)
**Dependencies:** TASK-0.1

**Current State:** Types exist (`BulkActionRequest`, `BulkActionResponse` at types.ts lines 252-270) but endpoint missing.

**Tasks:**
- [ ] Create `ui/src/app/api/issues/bulk/route.ts`
- [ ] Implement POST handler
- [ ] Support actions: export, tag, untag, priority, ignore, restore, process
- [ ] Include options parameter for process action

---

## TIER 10: Deferred Items (P3)

### TASK-10.1: URL Param Sync
**Priority:** P3 | **Effort:** 3 hours
**Tasks:**
- [ ] Sync filter state with URL query params (`?sort=priority&dir=desc`)
- [ ] Support shareable URLs

### TASK-10.2: Deferred UI Components
**Priority:** P3 | **Effort:** 4 hours total
**Tasks:**
- [ ] `DateRangePicker.tsx` - date range filter
- [ ] `ActionConfirmDialog.tsx` - confirmation modal
- [ ] Pause/Resume queue functionality (marked "for future use" at ProcessingQueue.tsx lines 22-24)
- [ ] Cancel pending item button

---

## Previously Completed Phases (PRD-001, PRD-002)

### CLI Core: COMPLETE
| Component | Status | Notes |
|-----------|--------|-------|
| `meta-ralph.sh` | Complete | Full orchestrator with dry-run, JSON output, filtering |
| `lib/provider.sh` | Complete | Provider interface with 4 required functions |
| `lib/priority.sh` | Complete | Cross-platform priority normalization (0-100) |
| `lib/ralph-engine.sh` | Complete | Claude Code fix loop with `<promise>COMPLETE</promise>` detection |
| `config.sh` | Complete | Centralized configuration, .env support |

### Providers
| Provider | Status | Notes |
|----------|--------|-------|
| `providers/zeropath/provider.sh` | Complete | Full API integration, PRD generation |
| `providers/sentry/provider.sh` | Complete | Full API integration, stack traces |
| `providers/codecov/` | Complete | Full implementation (provider, api, priority, test-detection) |
| `providers/github/` | Empty | Directory exists but contains no files |
| `providers/linear/` | Missing | Directory does not exist |

### UI Enhanced Features: COMPLETE
| Feature | Status |
|---------|--------|
| Search & Filtering | Complete |
| Sorting with persistence | Complete |
| Grouping views | Complete |
| Dashboard with charts | Complete |
| Processing queue visualization | Complete |
| Keyboard shortcuts | Complete |
| Theme toggle (dark/light/system) | Complete |
| Saved views | Complete |
| Processing history | Complete |
| Issue tagging | Complete |
| Pagination & virtualization | Complete |
| Export (CSV/JSON) | Complete |

### Testing Infrastructure: COMPLETE
| Component | Status |
|-----------|--------|
| GitHub Actions CI | Complete |
| ESLint configuration | Complete |
| Integration tests (31 tests) | Complete |
| E2E tests with Playwright (69 tests) | Complete |

---

## Recommended Implementation Order

### Phase A: Foundation (8-10 hours)
1. **TASK-0.1** Extended Types - 2 hours (unlocks everything)
2. **TASK-8.3** Config Variables - 0.5 hours
3. **TASK-1.8** Export ProcessingIndicator - 5 min

### Phase B: Streaming Infrastructure (12-16 hours)
4. **TASK-1.7** ralph-engine.sh JSON output - 2 hours
5. **TASK-1.6** Events parser library - 2 hours
6. **TASK-1.1** SSE API endpoint - 4 hours
7. **TASK-1.2** useProcessingStream hook - 3 hours
8. **TASK-1.3** useActivityFeed hook - 2 hours
9. **TASK-1.4** Update ActivityFeed component - 2 hours
10. **TASK-1.5** Update MetricsDisplay - 1 hour

### Phase C: Options Panel (12-14 hours)
11. **TASK-2.2** Presets library - 1 hour
12. **TASK-2.1** Options components - 6 hours
13. **TASK-2.3** useProcessingOptions hook - 2 hours
14. **TASK-2.4** Update ProcessButton - 1 hour
15. **TASK-2.5** Update BulkActionBar - 1 hour
16. **TASK-2.6** Update API to accept options - 2 hours

### Phase D: Modes & Model (8-10 hours)
17. **TASK-3.1** Plan/Build mode in ralph-engine.sh - 3 hours
18. **TASK-3.2** Mode badge in ProcessingQueue - 1 hour
19. **TASK-3.3** Plan/Build mode actions - 2 hours
20. **TASK-4.1** Model flag in ralph-engine.sh - 1 hour
21. **TASK-4.2** Model badge - 0.5 hours
22. **TASK-4.3** Smart model suggestion - 1 hour

### Phase E: Auto-Push (3-4 hours)
23. **TASK-5.1** Auto-push flag - 2 hours
24. **TASK-5.2** Push status in UI - 1 hour

### Phase F: Multi-Repo (14-18 hours)
25. **TASK-8.1** Workspace Manager - 4 hours
26. **TASK-8.2** Issue Parser - 3 hours
27. **TASK-8.4** Linear Provider - 6 hours
28. **TASK-8.5** Engine multi-repo integration - 2 hours

### Phase G: CI/CD Awareness (10-12 hours)
29. **TASK-6.1** useCIStatus hook - 3 hours
30. **TASK-6.2** CI API endpoints - 3 hours
31. **TASK-6.3** CIStatusPanel component - 3 hours

### Phase H: Plan Viewer (6-8 hours)
32. **TASK-7.1** Plan parser library - 2 hours
33. **TASK-7.2** PlanViewer component - 3 hours
34. **TASK-7.3** Plan API endpoints - 2 hours

### Phase I: Polish (8-10 hours)
35. **TASK-8.6** GitHub Provider - 4 hours
36. **TASK-9.1** Bulk Actions API - 2 hours
37. **TASK-10.x** Deferred items - as needed

**Total Estimated Effort:** 75-100 hours

---

## Critical Files Reference

| File | Purpose | Changes Needed |
|------|---------|----------------|
| `ui/src/lib/types.ts` | Core types | Add ProcessingMode, ModelType, ProcessingOptions, CI types, Activity types, MultiRepoIssue |
| `lib/ralph-engine.sh` | Backend engine | Add --mode, --model, --auto-push, --output-format=stream-json; multi-repo support |
| `ui/src/app/api/issues/route.ts` | Main API | Accept options parameter; integrate with streaming |
| `config.sh` | Configuration | Add LINEAR_*, META_RALPH_WORKSPACE, DEFAULT_* variables |
| `ui/src/components/queue/ProcessingQueue.tsx` | Queue UI | Add mode/model badges, integrate SSE, CI status |
| `ui/src/components/queue/ActivityFeed.tsx` | Activity display | Update types, connect to SSE |
| `ui/src/components/queue/index.ts` | Queue exports | Export ProcessingIndicator |
| `ui/src/hooks/index.ts` | Hooks barrel | Export new hooks |

---

## Gaps Found During Audit

### Code Issues Found
1. `--json` flag not implemented in CLI (fallback warning in `ui/src/lib/meta-ralph.ts:31-33`)
2. `ProcessingIndicator` not exported from `ui/src/components/queue/index.ts`
3. PR URLs hardcoded as `undefined` in ProcessingQueue.tsx (line 106)
4. Pause/Resume functionality marked "for future use" (lines 22-24)
5. ActivityFeed hardcoded to `activities={[]}` in ProcessingView.tsx (line 217)
6. MetricsDisplay hardcoded to `metrics={null}` in ProcessingView.tsx (line 225)
7. Activity types mismatch: current uses old types, spec requires new types

### Missing Files Summary

| Category | Files Missing |
|----------|---------------|
| Shell Libraries | `lib/workspace-manager.sh`, `lib/issue-parser.sh` |
| Providers | `providers/github/provider.sh`, `providers/linear/provider.sh` |
| UI Components | Entire `ui/src/components/options/` directory (6 components), `CIStatusPanel.tsx`, `PlanViewer.tsx` |
| Hooks | `useProcessingStream.ts`, `useActivityFeed.ts`, `useProcessingOptions.ts`, `useCIStatus.ts` |
| API Routes | `api/process/stream/`, `api/issues/bulk/`, `api/ci/status/`, `api/ci/logs/`, `api/plan/[issueId]/` |
| Libraries | `ui/src/lib/events.ts`, `ui/src/lib/presets.ts`, `ui/src/lib/plan-parser.ts` |

### Config Gaps

| Variable | Status |
|----------|--------|
| LINEAR_API_KEY | Missing |
| LINEAR_TEAM_ID | Missing |
| LINEAR_STATES | Missing |
| META_RALPH_WORKSPACE | Missing |
| WORKSPACE_CLEANUP_DAYS | Missing |
| PRIORITY_LINEAR_* | Missing |
| DEFAULT_PROCESSING_MODE | Missing |
| DEFAULT_MODEL | Missing |

---

## Notes

- CLI core is **complete** and stable for zeropath, sentry, codecov providers
- Enhanced UI (PRD-001) is **complete** except deferred items
- Codecov provider (PRD-002) is **fully implemented**
- PRD-03 through PRD-10 represent the **next major development phase**
- ActivityFeed, MetricsDisplay, ProcessingIndicator exist but need SSE integration
- Backward compatibility maintained - new features use optional fields/flags
- UI uses Next.js 15.1.0 + React 19.0.0 (App Router)
- All state management via React hooks and context (no external state library)
